<nav>
  <a routerLink="/">Back Home</a>
</nav>

<form
  [formGroup]="offerForm"
  class="record-form"
  enctype="multipart/form-data"
>
  <h2 class="step-title">What are you offering?</h2>

  <!-- Artist -->
  <mat-form-field
    class="record-form-field"
    [class.mat-form-field-invalid]="
      offerForm.get('artist')?.invalid &&
      (offerForm.get('artist')?.dirty || offerForm.get('artist')?.touched)
    "
  >
    <mat-label>Artist</mat-label>
    <input
      matInput
      formControlName="artist"
      (focus)="onFieldFocus('artist')"
      (input)="onFieldInput('artist', $any($event.target).value)"
      (blur)="onFieldBlur('artist')"
    />
    <mat-hint *ngIf="isHintVisible('artist')">Example: Miles Davis.</mat-hint>
    <mat-error *ngIf="!isFieldFocused('artist') && offerForm.get('artist')?.errors?.['required']">
      Artist is required
    </mat-error>
    <mat-error *ngIf="!isFieldFocused('artist') && offerForm.get('artist')?.errors?.['trimmedMinLength']">
      Artist must be at least 2 characters
    </mat-error>
  </mat-form-field>

  <!-- Title -->
  <mat-form-field
    class="record-form-field"
    [class.mat-form-field-invalid]="
      offerForm.get('title')?.invalid &&
      (offerForm.get('title')?.dirty || offerForm.get('title')?.touched)
    "
  >
    <mat-label>Title</mat-label>
    <input
      matInput
      formControlName="title"
      (focus)="onFieldFocus('title')"
      (input)="onFieldInput('title', $any($event.target).value)"
      (blur)="onFieldBlur('title')"
    />
    <mat-hint *ngIf="isHintVisible('title')">Example: Kind of Blue.</mat-hint>
    <mat-error *ngIf="!isFieldFocused('title') && offerForm.get('title')?.errors?.['required']">
      Title is required
    </mat-error>
    <mat-error *ngIf="!isFieldFocused('title') && offerForm.get('title')?.errors?.['trimmedMinLength']">
      Title must be at least 2 characters
    </mat-error>
  </mat-form-field>

  <!-- Genre -->
  <mat-form-field
    class="record-form-field"
    [class.mat-form-field-invalid]="
      offerForm.get('genre')?.invalid &&
      (offerForm.get('genre')?.dirty || offerForm.get('genre')?.touched)
    "
  >
    <mat-label>Genre</mat-label>
    <mat-select
      formControlName="genre"
      (focus)="onFieldFocus('genre')"
      (selectionChange)="onFieldInput('genre', $any($event.value))"
      (blur)="onFieldBlur('genre')"
    >
      <mat-option *ngFor="let genre of genreOptions" [value]="genre">
        {{ genre }}
      </mat-option>
    </mat-select>
    <mat-hint *ngIf="isHintVisible('genre')">Example: Jazz.</mat-hint>
    <mat-error *ngIf="!isFieldFocused('genre') && offerForm.get('genre')?.errors?.['required']">
      Genre is required
    </mat-error>
    <mat-error *ngIf="!isFieldFocused('genre') && offerForm.get('genre')?.errors?.['genreInvalid']">
      Choose a genre from the list
    </mat-error>
  </mat-form-field>

  <!-- Year -->
  <mat-form-field
    class="record-form-field"
    [class.mat-form-field-invalid]="
      offerForm.get('year')?.invalid &&
      (offerForm.get('year')?.dirty || offerForm.get('year')?.touched)
    "
  >
    <mat-label>Year</mat-label>
    <input
      matInput
      formControlName="year"
      (focus)="onFieldFocus('year')"
      (input)="onFieldInput('year', $any($event.target).value)"
      (blur)="onFieldBlur('year')"
    />
    <mat-hint *ngIf="isHintVisible('year')">Year between 1900 and today.</mat-hint>
    <mat-error *ngIf="!isFieldFocused('year') && offerForm.get('year')?.errors?.['required']">
      Year is required
    </mat-error>
    <mat-error *ngIf="!isFieldFocused('year') && offerForm.get('year')?.errors?.['yearRange']">
      Year must be between 1900 and the current year
    </mat-error>
  </mat-form-field>

  <!-- Condition -->
  <mat-form-field
    class="record-form-field"
    [class.mat-form-field-invalid]="
      offerForm.get('condition')?.invalid &&
      (offerForm.get('condition')?.dirty ||
        offerForm.get('condition')?.touched)
    "
  >
    <mat-label>Condition</mat-label>
    <mat-select
      formControlName="condition"
      (focus)="onFieldFocus('condition')"
      (selectionChange)="onFieldInput('condition', $any($event.value))"
      (blur)="onFieldBlur('condition')"
    >
      <mat-option *ngFor="let condition of conditionOptions" [value]="condition">
        {{ condition }}
      </mat-option>
    </mat-select>
    <mat-hint *ngIf="isHintVisible('condition')">
      Choose the closest grading label.
    </mat-hint>
    <mat-error *ngIf="!isFieldFocused('condition') && offerForm.get('condition')?.errors?.['required']">
      Condition is required
    </mat-error>
    <mat-error *ngIf="!isFieldFocused('condition') && offerForm.get('condition')?.errors?.['conditionInvalid']">
      Choose a condition from the list
    </mat-error>
  </mat-form-field>

  <!-- Price -->
  <mat-form-field
    class="record-form-field"
    [class.mat-form-field-invalid]="
      offerForm.get('price')?.invalid &&
      (offerForm.get('price')?.dirty || offerForm.get('price')?.touched)
    "
  >
    <mat-label>Price</mat-label>
    <input
      matInput
      formControlName="price"
      (focus)="onFieldFocus('price')"
      (input)="onFieldInput('price', $any($event.target).value)"
      (blur)="onFieldBlur('price')"
    />
    <span matSuffix>CAD</span>
    <mat-hint *ngIf="isHintVisible('price')">
      Numbers only. Example: 120 or 120.50.
    </mat-hint>
    <mat-error *ngIf="!isFieldFocused('price') && offerForm.get('price')?.errors?.['required']">
      Price is required
    </mat-error>
    <mat-error *ngIf="!isFieldFocused('price') && offerForm.get('price')?.errors?.['pattern']">
      Use a valid number (e.g. 10 or 10.50)
    </mat-error>
    <mat-error *ngIf="!isFieldFocused('price') && offerForm.get('price')?.errors?.['priceRange']">
      Price must be between 1 and 100000
    </mat-error>
  </mat-form-field>

  <!-- Image Upload -->
  <div class="record-form-field">
    <label for="file">Upload record photo (HEIC, JPEG, PNG)</label><br />
    <div class="hint-text" *ngIf="isHintVisible('file')">
      Max file size: 10 MB. Clear photo of the front and back is ideal.
    </div>
    <input
      type="file"
      id="file"
      (change)="onFileChange($event)"
      (focus)="onFieldFocus('file')"
      (blur)="onFieldBlur('file')"
      #fileInput
      accept="image/*"
    />
    <div *ngIf="isProcessingFile">Processing image...</div>
    <div *ngIf="fileError" class="error-text">{{ fileError }}</div>
    <div
      *ngIf="
        offerForm.get('file')?.invalid &&
        (offerForm.get('file')?.dirty || offerForm.get('file')?.touched)
      "
      class="error-text"
    >
      Photo is required
    </div>
  </div>

  <!-- Next -->
  <div class="submit-row">
    <button
      mat-raised-button
      color="primary"
      type="button"
      [disabled]="isProcessingFile || offerForm.invalid || !selectedFile"
      class="submit-button"
      (click)="onNext()"
    >
      Next
    </button>
  </div>
</form>
