<nav>
  <a routerLink="/">Back Home</a>
</nav>

<form
  [formGroup]="recordForm"
  (ngSubmit)="onSubmit()"
  class="record-form"
  enctype="multipart/form-data"
>
  <!-- Title -->
  <mat-form-field
    class="record-form-field"
    [class.mat-form-field-invalid]="
      recordForm.get('title')?.invalid &&
      (recordForm.get('title')?.dirty || recordForm.get('title')?.touched)
    "
  >
    <mat-label>Title</mat-label>
    <input matInput formControlName="title" />
    <mat-error *ngIf="recordForm.get('title')?.errors?.['required']">
      Title is required
    </mat-error>
    <mat-error *ngIf="recordForm.get('title')?.errors?.['minlength']">
      Title must be at least 2 characters
    </mat-error>
  </mat-form-field>

  <!-- Artist -->
  <mat-form-field
    class="record-form-field"
    [class.mat-form-field-invalid]="
      recordForm.get('artist')?.invalid &&
      (recordForm.get('artist')?.dirty || recordForm.get('artist')?.touched)
    "
  >
    <mat-label>Artist</mat-label>
    <input matInput formControlName="artist" />
    <mat-error *ngIf="recordForm.get('artist')?.errors?.['required']">
      Artist is required
    </mat-error>
    <mat-error *ngIf="recordForm.get('artist')?.errors?.['minlength']">
      Artist must be at least 2 characters
    </mat-error>
  </mat-form-field>

  <!-- Genre -->
  <mat-form-field
    class="record-form-field"
    [class.mat-form-field-invalid]="
      recordForm.get('genre')?.invalid &&
      (recordForm.get('genre')?.dirty || recordForm.get('genre')?.touched)
    "
  >
    <mat-label>Genre</mat-label>
    <input matInput formControlName="genre" />
    <mat-error *ngIf="recordForm.get('genre')?.errors?.['required']">
      Genre is required
    </mat-error>
    <mat-error *ngIf="recordForm.get('genre')?.errors?.['minlength']">
      Genre must be at least 2 characters
    </mat-error>
  </mat-form-field>

  <!-- Year -->
  <mat-form-field
    class="record-form-field"
    [class.mat-form-field-invalid]="
      recordForm.get('year')?.invalid &&
      (recordForm.get('year')?.dirty || recordForm.get('year')?.touched)
    "
  >
    <mat-label>Year</mat-label>
    <input matInput formControlName="year" />
    <mat-error *ngIf="recordForm.get('year')?.errors?.['required']">
      Year is required
    </mat-error>
    <mat-error *ngIf="recordForm.get('year')?.errors?.['pattern']">
      Year must be a valid number
    </mat-error>
  </mat-form-field>

  <!-- Condition -->
  <mat-form-field
    class="record-form-field"
    [class.mat-form-field-invalid]="
      recordForm.get('condition')?.invalid &&
      (recordForm.get('condition')?.dirty ||
        recordForm.get('condition')?.touched)
    "
  >
    <mat-label>Condition</mat-label>
    <input matInput formControlName="condition" />
    <mat-error *ngIf="recordForm.get('condition')?.errors?.['required']">
      Condition is required
    </mat-error>
    <mat-error *ngIf="recordForm.get('condition')?.errors?.['minlength']">
      Condition must be at least 2 characters
    </mat-error>
  </mat-form-field>

  <!-- Price -->
  <mat-form-field
    class="record-form-field"
    [class.mat-form-field-invalid]="
      recordForm.get('price')?.invalid &&
      (recordForm.get('price')?.dirty || recordForm.get('price')?.touched)
    "
  >
    <mat-label>Price</mat-label>
    <input matInput formControlName="price" />
    <mat-error *ngIf="recordForm.get('price')?.errors?.['required']">
      Price is required
    </mat-error>
    <mat-error *ngIf="recordForm.get('price')?.errors?.['pattern']">
      Use a valid number (e.g. 10 or 10.50)
    </mat-error>
  </mat-form-field>

  <!-- Image Upload -->
  <div class="record-form-field">
    <label for="file">Upload record photo (HEIC, JPEG, PNG)</label><br />
    <input
      type="file"
      id="file"
      (change)="onFileChange($event)"
      #fileInput
      accept="image/*"
    />
    <div *ngIf="isProcessingFile">Processing image...</div>
    <div *ngIf="fileError" class="error-text">{{ fileError }}</div>
    <div
      *ngIf="
        recordForm.get('file')?.invalid &&
        (recordForm.get('file')?.dirty || recordForm.get('file')?.touched)
      "
      class="error-text"
    >
      Photo is required
    </div>
  </div>

  <!-- Submit -->
  <div class="submit-row">
    <button
      mat-raised-button
      color="primary"
      type="submit"
      [disabled]="
        isProcessingFile || isSubmitting || recordForm.invalid || !!submitError
      "
      class="submit-button"
    >
      <ng-container *ngIf="!isSubmitting; else submitting">
        Submit
      </ng-container>
      <ng-template #submitting>
        <mat-progress-spinner
          mode="indeterminate"
          diameter="24"
          strokeWidth="3"
        ></mat-progress-spinner>
      </ng-template>
    </button>
    <div *ngIf="submitError" class="error-text">{{ submitError }}</div>
  </div>
</form>
